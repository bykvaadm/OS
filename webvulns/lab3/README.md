# Уязвимости практика 3 часть 3: Сканирование

## Prerequirements:

1. Скачать уязвимый образ виртуальной машины [https://sourceforge.net/projects/metasploitable](https://sourceforge.net/projects/metasploitable)
2. Развернуть kali linux
3. Настроить сетевую связность между двумя виртуальными машинами

Def IPVulnBox = ip адрес виртуальной машины metasploitable

Def IfKaliLinux = интерфейс в вашей виртуальной машине, с которого доступен VulnBox

Def *** = задача с дополнительными баллами

**Задание 1:** выполнить сканирование с помощью nmap

```shellsession
# nmap IPVulnBox
```

Занести данные в таблицу:

| Port | State | Service |
| --- | --- | --- |
|   |   |   |

*** Попробуйте использовать другие типы сканирования и диапазоны портов, составьте таблицу из вариантов, которые вы попробовали и дополнительными результатами, которые это принесло.

| Nmap key | Port | State | Service |
| --- | --- | --- | --- |
|  |  |  |  |

**Задание 2:** поиск и работа со скриптами nmap

Выполнить команду поиска доступных скриптов nmap:

```shellsession
# locate *.nse
```

Определите какие сервисы, найденные в задании 1 можно проверить скриптами, найденными предыдущей командой. Составьте таблицу, указывающую сервис и подходящий скрипт.

| Service | Script |
| --- | --- |
|  |  |

Например, для сервиса ftp:

```shellsession
# locate *ftp*.nse
```

Попробуйте применить один из найденных скриптов к сервису:

```shellsession
# nmap -p 21 --script ftp-anon IPVulnBox
```

**Задание 3:** знакомство с metasploit

Выполнить команды для подготовки рабочей среды metasploit

```shellsession
# systemctl start postgresql
# msfdb init
# msfconsole
```

Внутри msf также можно запускать nmap, однако в отличие от простого запуска, полученными данными потом очень удобно оперировать - полученные порты, хосты и сервисы заносятся в базу данных, откуда впоследствии их можно извлекать для проведения атак, выгрузки для отчетов или переноса в другой сервис. Для этого мы в предыдущем пункте подключали базу postgresql. Кроме того в msf существуют workspaces, которые можно использовать для разделения сканируемых объектов на задачи и подзадачи.

Создайте новое рабочее пространство и посмотрите существующие:

```shellsession
msf > workspace -a lab33
msf > workspace
```

Запустите nmap, сохранив при этом результаты в базу данных

```shellsession
msf > db_nmap -v -sV IPVulnBox
```

Посмотрите какие результаты сохранились в базу данных

```shellsession
msf> hosts -c address,os_flavor -S Linux
msf> services
```

В msf кроме nmap существуют и собственные модули для выполнения сканирования:

Посмотрите список модулей, выберите один и добавьте все хосты из базы данных в список сканируемых хостов этого модуля. Посмотрите опции.

```shellsession
msf> search portscan
msf> use auxiliary/scanner/portscan/ack
msf> hosts -c address,os_flavor -S Linux -R
msf> show options
```

- Какой ключ добавляет хосты в список хостов для сканирования?

Установите дополнительные опции - укажите интерфейс с которого произвести сканирование, а также задайте порты для сканирования, после чего запустите сканирование.

например:

```shellsession
msf> set interface IfKaliLinux
msf> ...
msf> run
```

*** Попробуйте подобрать какой-нибудь другой модуль для сканирования сервисов (не ftp) и выполните сканирование, например:

```shellsession
msf> use auxiliary/scanner/smb/smb_enumusers
msf> run
```

- Какой результат вы получили?
- Какие еще модули сканирования вам удалось задействовать?

---

Лабораторную работу сдавать, отвечая на все вопросы, прикладывать скриншоты.

За выполнение ЛР сугубо по примерам - 1 балл, за  использование дополнительных модулей сканирования начисляется +0,2 балла за каждый модуль, но не более 1 балла в рамках каждого примера. В сумме за ЛР начисляется от 1 до 3 баллов.
