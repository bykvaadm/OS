# Лабораторная работа №1: "Разведка"

## Начальные условния:

* Имя компании: АО "БИФИТ"
* Доменное имя: bifit.com
* IP адрес(а): --

## Цели данной лабораторной работы

1. Получить IP адреса принадлежщие компании
2. Получить доменные имена второго и третьего уровней принадлежащие компании
3. Собрать информацию о сотрудниках компании

## Задание 0: Сбор информации о доменах предприятия с основного сайта

~no one~

## Задание 1: Получение информации от dns серверов

Используя следующие утилиты получите информацию об адресах организации:
* host
* nslookup
* dig (Типы запросов: NS,ANY,TXT,AXFR,PTR)

Например:
```bash
host mospolytech.ru
nslookup mospolytech.ru
dig -t axfr mospolytech.ru
```

Используя утилиту dig вы получите используемые ns-сервера компании. Проделайте все предыдущие шаги с утилитой dig,
дополнив команду ключом, который укажет dig обаращаться за информацией непосредственно к этим серверам (@ns.company.com)

Запишите полученные данные в таблицу и ответьте на вопросы:
* Что такое записи ANY,TXT,AXFR,PTR,А?
  * ANY -- любая DNS запись
  * TXT -- свободная текстовая запись
  * AXFP -- передача зоны DNS, метод репликации
  * PTR -- обратная запись для A или AAAA
* Что такое запись SOA?
  * SOA -- Start Of Authority запись, источник на который должны опираться иные 
* Что такое NS?
  * NS -- Name Server
* Какие DNS сервера бывают? (вендор)
  * BIND
  * Dnsmasq
  * Unbound
  * dnrd
* С каким dns сервером взаимодействовали вы?
  * 8.8.8.8, 8.8.4.4
* Что такое атака zone transfer и чем она не безопасна как в локальных так и во внешних сетях?
  * ситуация, при которой кто-то предтворяется подчиненным и выкачивает копию базы
  * опасно тем, что может являться подготовительным этапом перед тем как положат ваш DNS server и начнут им притворяться

## Задание 2: Поиск информации у регистратора по заданному домену

Получаем netblock и дополнительную информацию о принадлежности адреса какой-либо организации

```bash
$ whois ptsecurity.com
```

Заполнить таблицу:

|                 |Информация о домене bifit.com|
|---              |---                          |
|Владелец         | Registrant Name: BIFIT      |
|Почтовые адреса  | Registrant Street: 46, Nizhnyaya Pervomayskaya st. |
|Физические адреса| Registrant City: Moscow <br> Registrant State/Province: Russia |
|IP адреса        |   |
|Телефоны         | Registrant Phone: +7.4955321502 |
|ДНС сервера      | Name Server: PUB4.BIFIT.COM <br> Name Server: PUB5.BIFIT.COM <br> Name Server: PUB3.BIFIT.COM  |
|DNSSEC           | unsigned |

## Задание 3: Использование поисковых движков

Используя данные поисковые движки попытайтесь собрать информацию о вашей цели. Запишите полученные данные в таблицу.

* http://2ip.ru
* https://domainbigdata.com
* http://searchdns.netcraft.com/;
* https://www.shodan.io/host/;
* https://censys.io/
* https://crt.sh
* https://community.riskiq.com/
* http://whois.webhosting.info/x.x.x.x
* http://google.com (inurl, site, filetype, cache, etc...)
* https://www.censys.io/ipv4?q=mospolytech.ru
* https://bgp.he.net/dns/mospolytech.ru

Вы должны получить информацию следующего характера:

* Информация об IP адресе или домене
* IP интернет ресурса
* Система управления сайтом (CMS)
* Хостинг сайта
* Информация о сайте
* Сайты на одном IP
* Все домены одного владельца
* DNS параметры домена
* Поиск доменного имени
* Определение IP адреса по Е-mail
* Информация об AS (автономных системах) принадлежащих искомой цели и адреса блоков, которые им соответствуют.

## Задание 4: Поиск информации о суб-доменах по заданному домену

В терминале ввести команды:

```
$ recon-ng
[recon-ng][default] > load google_site_web
recon-ng][default][google_site_web] > set source mospolytech.ru
[recon-ng][default][google_site_web] > run
```

Заполнить таблицу:

Найденные суб домены|
--------------------|
example.company.com |

Ответьте на вопросы:
* Какую информацию вы получили на выходе?
* Где можно применить эту информацию?


## Задание 5: Поиск информации у DNS серверов по заданному домену

Задание будет выполняться с использованием утилиты dnsrecon (DNS enumeration, revers lookup, scanning, whois recon)

В терминале ввести команды:

```
$ dnsrecon -d mospolytech.ru
```

Заполнить таблицу:

|Тип записи|Доменное имя|IP адрес|
|---       |---         |---     |
| SOA | pub4.bifit.com | 109.232.255.219 |
| NS | pub4.bifit.com | 109.232.255.219 |
| NS | pub5.bifit.com | 109.232.254.152 |
| NS | pub3.bifit.com | 109.234.39.37 |
| MX | pub2.bifit.com | 109.232.255.213 |
| MX | pub6.bifit.com | 109.232.254.135 |
| TXT | bifit.com | v=spf1 mx ip4:109.232.255.173 ip4:109.232.254.169 ip4:109.232.254.242 -all |

Вместо google dns попробуйте подставить ns сервера, которые вы нашли ранее, запишите их в таблицу:

|Найденный NS сервер|IP адрес|
|---                |---     |
| pub4.bifit.com | 109.232.255.219 |
| pub3.bifit.com | 109.234.39.37 |
| pub5.bifit.com | 109.232.254.152 |

Попробуйте также несколько других утилит и запишите данные в таблицу:
* dnsenum
* dnsmap

Дополнительные материалы для изучения:
* https://xakep.ru/2017/09/19/hack-contest-dns-dig

Ответьте на вопросы:
* Какую еще информацию вы почерпнули из вывода команды?
* Где можно применить эту информацию?

Попробуем использовать грубый перебор по словарю, чтобы выявить домены, 
которых нет в google, и о которых нам не рассказал NS.

В терминале ввести команды:

```
# cd /usr/share/wordlists/
# git clone https://github.com/rbsec/dnscan.git
# dnsrecon -d mospolytech.ru -t brt -D /usr/share/wordlists/dnscan/subdomains-10000.txt
```

Ответьте на вопросы:
* Какие дополнительные результаты принес нам этот словарь?

Дополнительно рассмотрите следующие утилиты для перебора:
* knockpy
* subdomains.py

## Задание 6: Рассмотрите дополнительные утилиты для сбора информации  
   
* Amass (Very fast brute)
* subfinder (Brute and finding)
* Aquatone (Using public services like: shodan, censys, riskiq...)

Собрать данные и занести в таблицу.


## Задание 7: История DNS имён

```
http://viewdns.info/iphistory/?domain=mospolytech.ru
```

## Задание 8: Поиск сертификатов

```
https://crt.sh/?q=%25.mospolytech.ru
```

## Задание 9: Поиск информации о почтовых ящиках по заданному домену


```
$ theharvester -d mospolytech.ru -b all
```
Полученные результаты занести в таблицу:

Найденные IP адреса|Найденные доменные имена|Найденные почтовые ящики
-------------------|------------------------|------------------------
--     | agses1.bifit.com:empty <br> edo.bifit.com:109.232.254.163 <br> kassa.bifit.com:109.232.254.149  <br> pub5.bifit.com:109.232.254.152  <br> sd.bifit.com:109.232.255.83 <br> webinars-b.bifit.com:109.232.254.250 <br> webinars.bifit.com:109.232.254.242 <br> www.bifit.com:109.232.255.200 | info@bifit.com <br> job@bifit.com <br> repan@bifit.com <br> ab@bifit.com <br> support@bifit.com <br> naletova@bifit.com <br> hr@bifit.com <br> legal@bifit.com <br> levin@bifit.com <br> indicator@bifit.com <br> zybina@bifit.com <br> bulavintseva@bifit.com <br> kozlyuk@bifit.com

Ответьте на вопросы:
* Какую информацию вы получили на выходе?
* Где можно применить эту информацию?

## Задание 10: Агрегированный поиск информации.

Введите команду:

```
# dmitry mospolytech.ru
```

Запишите полученные результаты в таблицу.

## Задание 11: Повторный проход и поиск новой информации

Соберите все полученные данные в единую таблицу. Для каждого найденного ip адреса, dns адреса, домена или субдомена
выполните повторный поиск по пунктам 1-11 и добавьте полученные данные в таблицу.

Это задание очень трудоемкое - каждый ответ на каждое задание может принести вам новую информацию,
которая также должна быть проверена через список выше, что в свою очередь опять может принести информацию 
и так далее по кругу. Поэтому в данном случае стоит в какой-то момент прекратить выполение лабораторной работы.

## Задание 12: Maltego

Ознакомьтесь с софтом Maltego, указав ему ваш исходный домен и посмотрите, сможет ли автоматика собрать информации
больше чем вы. Учтите, что в зависимости от выбранного режима могут встречаться фальшпозитивы, которые требуется
обрабатывать вручную, убеждаясь принадлежит ли данная информация искомой цели или нет.

P.S. для работы с maltego вам придется зарегистрировать себе аккаунт

## Задание 13: Сбор информации о сотрудниках компании

* http://people.yandex.ru/ (Агрегированный поиск людей в различных социальных сетях)
* http://vk.com, http://ok.ru, http://facebook.com (Социальные сети)
* TheHarvester, Z-Harvester (Поиск e-mail адресов в публичном доступе)
* Recon-ng (domains-contacts,companies-contacts, domains-creds)
* Liked databases (http://databases.today/, http://snusbase.com/)
* FOCA (https://www.elevenpaths.com/labstools/foca/index.html) (Поиск документов различных форматов в веб-приложениях и публичных сервисах принадлжащих компании)
* Passwords (https://intelx.io/, )

Пример поиска + табличка:
* https://habrahabr.ru/company/echelon/blog/321754/

Дополнительно:
* http://osintframework.com/
* https://namechk.com